import React from 'react';
import PropTypes from 'prop-types';
import { connect } from 'react-redux';
import { Button, Modal, Form, Input, Checkbox } from 'antd';
import { logoSrc, logoText } from '../../config';
import { bindActionCreators } from 'redux';
import { login, showLoginLoading, hideLoginLoading, } from '../../redux/actions/user';

import './index.less';

const FormItem = Form.Item;
// 写法一，下方有非注解写法
@connect(
  state => {
    return { userReducer: state.userReducer };
  },
  dispatch => bindActionCreators({ login, showLoginLoading, hideLoginLoading, }, dispatch)
)
class Login extends React.Component {
  constructor(props) {
    super(props);
    this.state = {};
    this.handleOk = this.handleOk.bind(this);
  }

  info = ({ title = '提示信息', messages = ['请联系管理员', '修改密码'] }) => {
    const messageDoms = messages.map((message) => (<p>{message}</p>));
    Modal.info({
      title,
      content: (
        <div>
          {messageDoms}
        </div>
      ),
      onOk() {
      }
    });
  };

  // 此法保持作用域，调用时无需绑定作用域
  handleSubmit = (e) => {
    e.preventDefault();
    this.props.form.validateFields((err, values) => {
      if (!err) {
        console.log('Received values of form: ', values);
        this.props.login(values);
      }
    });
  };

  // 调用时须需绑定作用域 例： this.handleOk().bind(this)
  handleOk() {
    this.props.form.validateFieldsAndScroll((errors, values) => {
      if (errors) {
        return;
      }
      console.log('000000', values);
    });
  }

  render() {
    const { loginLoading } = this.props.userReducer;
    const { getFieldDecorator, } = this.props.form;
    return (
      <div className='form'>
        <div className='logo'>
          <img alt={'logo'} src={logoSrc}/>
          <span>{logoText}</span>
        </div>
        <form>
          <FormItem hasFeedback>
            {getFieldDecorator('account', {
              rules: [
                {
                  required: true,
                },
              ],
            })(<Input size="large" onPressEnter={this.handleOk} placeholder="账号"/>)}
          </FormItem>
          <FormItem hasFeedback>
            {getFieldDecorator('password', {
              rules: [
                {
                  required: true,
                },
              ],
            })(<Input size="large" type="password" onPressEnter={this.handleOk} placeholder="密码"/>)}
          </FormItem>
          <FormItem>
            {getFieldDecorator('remember', {
              valuePropName: 'checked',
              initialValue: true,
            })(
              <Checkbox>记住我</Checkbox>
            )}
            <a className="login-form-forgot" onClick={this.info} style={{ float: 'right' }}>忘记密码</a>
            <Button type="primary" size="large" onClick={this.handleSubmit} className="login-form-button"
                    loading={loginLoading}>
              登录
            </Button>
            或 <a onClick={this.info.bind(this, { title: '提示信息', messages: ['请联系管理员', '申请开通账号'] })}>现在就去注册!</a>
          </FormItem>
        </form>
      </div>
    );
  }
}

Login.propTypes = {
  form: PropTypes.object,
};

// 写法二，我采用了顶部注解的方式

// const mapStateToProps = state => {
//   const userReducer = state.userReducer;
//   return { userReducer, };
// };
// const mapDispatchToProps = dispatch => ({
//   login: bindActionCreators(login, dispatch),
//   showLoginLoading: bindActionCreators(showLoginLoading, dispatch),
//   hideLoginLoading: bindActionCreators(hideLoginLoading, dispatch),
// });
//
// export default connect(mapStateToProps, mapDispatchToProps)(Form.create()(Login));
export default Form.create()(Login);
