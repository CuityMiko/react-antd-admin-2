/**
 * @description 应用中心reducer
 * @author yq
 * @date 2017/8/25 下午4:55
 */
import { message } from 'antd';
import * as types from '../types/app';
import { systemPrefix } from '../../config';

const initialState = {
  spinning: false, // 是否显示页面旋转图标
  loading: false, // 是否显示表格loading
  user: {},
  permissions: {
    visit: [],
  },
  menus: [
    {
      id: '1',
      title: '引导页',
      key: '1',
      path: '/home/guide',
      icon: 'flag'
    },
    {
      id: '2',
      title: '接口管理',
      key: '2',
      icon: 'setting',
      children: [
        {
          id: '3',
          pid: '2',
          title: '接口列表',
          key: '3',
          path: '/home/api/list',
          ancestor: ['api'],
        },
      ]
    },
  ],
  openKeys: [],
  selectedKeys: [],
  collapsed: window.localStorage.getItem(`${systemPrefix}-COLLAPSED`) === 'true',
  theme: window.localStorage.getItem(`${systemPrefix}-THEME`) === 'true',
  menuPopoverVisible: false,
  isNavbar: document.body.clientWidth < 769,
};

const updateState = (state, { payload }) => {
  return {
    ...state,
    ...payload,
  };
};

const collapseMenu = (state) => {
  window.localStorage.setItem(`${systemPrefix}-COLLAPSED`, !state.collapsed);
  return {
    ...state,
    collapsed: !state.collapsed,
  };
};

const switchTheme = (state) => {
  window.localStorage.setItem(`${systemPrefix}-THEME`, !state.theme);
  return {
    ...state,
    theme: !state.theme,
  };
};

const switchMenuPopover = (state) => {
  return {
    ...state,
    menuPopoverVisible: !state.menuPopoverVisible,
  };
};

const app = (state = initialState, action) => {
  switch (action.type) {
    case types.UPDATE_STATE:
      return updateState(state, action);
    case types.COLLAPSE_MENU:
      return collapseMenu(state);
    case types.SWITCH_THEME:
      return switchTheme(state);
    case types.SWITCH_MENU_POPOVER:
      return switchMenuPopover(state);
    case types.HANDLE_SUCCESS:
      message.success(action.payload.msg || '操作成功');
      return {
        ...state,
      };
    case types.HANDLE_FAILED:
      message.error(action.payload.msg || '操作失败，请稍后重试');
      return {
        ...state,
      };
    default:
      return state;
  }
};

export default app;
